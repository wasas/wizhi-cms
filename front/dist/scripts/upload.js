!function(t){var n={url:document.URL,method:"POST",extraData:{},maxFileSize:0,allowedTypes:"*",dataType:null,fileName:"file",onInit:function(){},onFallbackMode:function(){message},onNewFile:function(e,t){},onBeforeUpload:function(e){},onComplete:function(){},onUploadProgress:function(e,t){},onUploadSuccess:function(e,t){},onUploadError:function(e,t){},onFileTypeError:function(e){},onFileSizeError:function(e){}},o=function(e,o){return this.element=t(e),this.settings=t.extend({},n,o),!!this.checkBrowser()&&(this.init(),!0)};o.prototype.checkBrowser=function(){return void 0===window.FormData?(this.settings.onFallbackMode.call(this.element,"Browser doesn't support From API"),!1):this.element.find("input[type=file]").length>0||(!(!this.checkEvent("drop",this.element)||!this.checkEvent("dragstart",this.element))||(this.settings.onFallbackMode.call(this.element,"Browser doesn't support Ajax Drag and Drop"),!1))},o.prototype.checkEvent=function(e,t){var t=t||document.createElement("div"),e="on"+e,n=e in t;return n||(t.setAttribute||(t=document.createElement("div")),t.setAttribute&&t.removeAttribute&&(t.setAttribute(e,""),n="function"==typeof t[e],void 0!==t[e]&&(t[e]=void 0),t.removeAttribute(e))),t=null,n},o.prototype.init=function(){var e=this;e.queue=new Array,e.queuePos=-1,e.queueRunning=!1,e.element.on("drop",function(t){t.preventDefault();var n=t.originalEvent.dataTransfer.files;e.queueFiles(n)}),e.element.find("input[type=file]").on("change",function(n){var o=n.target.files;e.queueFiles(o),t(this).val("")}),this.settings.onInit.call(this.element)},o.prototype.queueFiles=function(e){for(var t=this.queue.length,n=0;n<e.length;n++){var o=e[n];if(this.settings.maxFileSize>0&&o.size>this.settings.maxFileSize)this.settings.onFileSizeError.call(this.element,o);else if("*"==this.settings.allowedTypes||o.type.match(this.settings.allowedTypes)){this.queue.push(o);var i=this.queue.length-1;this.settings.onNewFile.call(this.element,i,o)}else this.settings.onFileTypeError.call(this.element,o)}return!this.queueRunning&&(this.queue.length!=t&&(this.processQueue(),!0))},o.prototype.processQueue=function(){var n=this;if(++n.queuePos>=n.queue.length)return n.settings.onComplete.call(n.element),n.queuePos=n.queue.length-1,void(n.queueRunning=!1);var o=n.queue[n.queuePos],i=new FormData;i.append(n.settings.fileName,o),t.each(n.settings.extraData,function(e,t){i.append(e,t)}),n.settings.onBeforeUpload.call(n.element,n.queuePos),n.queueRunning=!0,t.ajax({url:n.settings.url,type:n.settings.method,dataType:n.settings.dataType,data:i,cache:!1,contentType:!1,processData:!1,forceSync:!1,xhr:function(){var o=t.ajaxSettings.xhr();return o.upload&&o.upload.addEventListener("progress",function(t){var o=0,i=t.loaded||t.position,s=t.total||e.totalSize;t.lengthComputable&&(o=Math.ceil(i/s*100)),n.settings.onUploadProgress.call(n.element,n.queuePos,o)},!1),o},success:function(e,t,o){n.settings.onUploadSuccess.call(n.element,n.queuePos,e)},error:function(e,t,o){n.settings.onUploadError.call(n.element,n.queuePos,o)},complete:function(e,t){n.processQueue()}})},t.fn.dmUploader=function(e){return this.each(function(){t.data(this,"dmUploader")||t.data(this,"dmUploader",new o(this,e))})},t(document).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),t(document).on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),t(document).on("drop",function(e){e.stopPropagation(),e.preventDefault()})}(jQuery),jQuery(document).ready(function(e){e(".fn-dnd-zone").dmUploader({url:e(".fn-dnd-zone .upload_shadow").data("url"),type:"POST",dataType:"json",allowedTypes:"image/*",onUploadSuccess:function(t,n){e(this).find(".frm-thumbs").append('<input type="hidden" name="'+e(this).data("name")+'" value="'+n.id+'">'),e(this).find(".frm-preview").show().append('<div class="col-xs-6 col-md-3"><button data-value="'+n.id+'" type="button" class="close"><span>Ã—</span></button><a href="#" class="thumbnail"><img src="'+n.thumb+'" alt="..."></a></div>')}}),e(".fn-dnd-zone button.close").on("click",function(){var t=e(this).data("value");e(this).parent().remove(),e(".frm-thumbs input[value="+t+"]").remove()})});
//# sourceMappingURL=upload.js.map
